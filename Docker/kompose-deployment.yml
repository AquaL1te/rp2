apiVersion: apps/v1
kind: StatefulSet
metadata:
  annotations:
    kompose.cmd: kompose --file=docker-compose.yml convert
    kompose.version: 1.17.0 (HEAD)
  labels:
    app: ndn-producer
  name: ndn-producer
spec:
  selector:
    matchLabels:
      app: ndn-producer
  serviceName: ndn-producer
  replicas: 1
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: ndn-producer
    spec:
      containers:
      - env:
        - name: gateway
          value: ndn-router
        - name: monitoring_port
          value: "8081"
        - name: routes
          value: ndn-router
        image: aqual1te/ndn:producer1
        name: ndn-producer1
        ports:
        - containerPort: 8080
      restartPolicy: Always
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: ndn-router  
  annotations:
    kompose.cmd: kompose --file=docker-compose.yml convert
    kompose.version: 1.17.0 (HEAD)
  labels:
    app: ndn-router
spec:
  selector:
    matchLabels:
      app: ndn-router
  serviceName: ndn-router
  replicas: 1
  template:
    metadata:
      labels:
        app: ndn-router
    spec:
      # initContainers: # it might work
      # - name: ndn-producer1
      #   image: busybox
      #   command: ['sh', '-c', 'until nslookup ndn-producer-0; do echo waiting for ndn-producer-0; sleep 2; done;']
      containers:
      - env:
        - name: gateway
          value: ndn-producer
        - name: monitoring_port
          value: "8080"
        - name: routes
          value: /ndn/ark /ndn/doi /ndn/handle /ndn/urn
        image: aqual1te/ndn:router1
        name: ndn-router1
        ports:
        - containerPort: 8080
      restartPolicy: Always
